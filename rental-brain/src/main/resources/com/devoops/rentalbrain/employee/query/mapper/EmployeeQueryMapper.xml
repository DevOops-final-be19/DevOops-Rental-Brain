<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.devoops.rentalbrain.employee.query.mapper.EmployeeQueryMapper">
    <resultMap id="empInfoPageResultMap" type="com.devoops.rentalbrain.employee.query.dto.EmployeeInfoDTO">
        <id property="id" column="id"/>
        <result property="emp_id" column="emp_id"/>
        <result property="name" column="name"/>
        <result property="phone" column="phone"/>
        <result property="email" column="email"/>
        <result property="addr" column="addr"/>
        <result property="birthday" column="birthday"/>
        <result property="gender" column="gender"/>
        <result property="status" column="status"/>
        <result property="dept" column="dept"/>
        <result property="hire_date" column="hire_date"/>
        <association property="position" javaType="com.devoops.rentalbrain.employee.query.dto.PositionDTO">
            <id property="position_id" column="position_id"/>
            <result property="position_name" column="position_name"/>
        </association>

    </resultMap>

    <resultMap id="empListResultMap" type="com.devoops.rentalbrain.employee.query.dto.EmployeeListDTO">
        <id property="id" column="id"/>
        <result property="emp_id" column="emp_id"/>
        <result property="name" column="name"/>
        <result property="phone" column="phone"/>
        <result property="email" column="email"/>
        <result property="addr" column="addr"/>
        <result property="birthday" column="birthday"/>
        <result property="gender" column="gender"/>
        <result property="status" column="status"/>
        <result property="dept" column="dept"/>
        <result property="hire_date" column="hire_date"/>
        <association property="position" javaType="com.devoops.rentalbrain.employee.query.dto.PositionDTO">
            <id property="position_id" column="position_id"/>
            <result property="position_name" column="position_name"/>
        </association>
        <collection property="empPositionAuth" ofType="com.devoops.rentalbrain.employee.query.dto.PositionAuthDTO">
            <id property="emp_position_auth_id" column="emp_position_auth_id"/>
            <result property="ep_position_id" column="ep_position_id"/>
            <result property="ep_auth_id" column="ep_auth_id"/>
        </collection>
        <collection property="empAuth" ofType="com.devoops.rentalbrain.employee.query.dto.EmpAuthDTO">
            <id property="employee_auth_id" column="employee_auth_id"/>
            <result property="ea_auth_id" column="ea_auth_id"/>
            <result property="ea_user_id" column="ea_user_id"/>
        </collection>

    </resultMap>
    <select id="getUserAuth" resultType="string">
        SELECT
               a.auth
          FROM auth_list a
         WHERE a.id IN (SELECT
                               b.auth_id
                          FROM employee_auth b
                         WHERE emp_id = #{empId}
                         UNION
                        SELECT
                               c.auth_id
                          FROM emp_position_auth c
                         WHERE position_id = #{positionId})
    </select>
    <select id="getEmpInfoPage" resultMap="empInfoPageResultMap">
        SELECT
               a.id,
               a.emp_id,
               a.name,
               a.phone,
               a.email,
               a.addr,
               a.birthday,
               a.gender,
               a.status,
               a.dept,
               a.hire_date,
               b.id as position_id,
               b.position_name
          FROM employee a JOIN emp_position b
            ON a.position_id = b.id
         WHERE emp_id = #{empId}
    </select>

    <select id="getEmpList" resultMap="empListResultMap">
        SELECT
               a.id,
               a.emp_id,
               a.name,
               a.phone,
               a.email,
               a.addr,
               a.birthday,
               a.gender,
               a.status,
               a.dept,
               a.hire_date,
               a.resign_date,
               b.id as position_id,
               b.position_name,
               c.id as emp_position_auth_id,
               c.position_id as ep_position_id,
               c.auth_id as ep_auth_id,
               d.id as employee_auth_id,
               d.auth_id as ea_auth_id,
               d.emp_id as ea_user_id
          FROM employee a
     LEFT JOIN emp_position b
            ON a.position_id = b.id
     LEFT JOIN emp_position_auth c
            ON b.id = c.position_id
     LEFT JOIN employee_auth d
            ON a.id = d.emp_id
    </select>
</mapper>